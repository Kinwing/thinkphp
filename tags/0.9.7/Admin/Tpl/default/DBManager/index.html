{// 引入标签库 }
<tagLib name="html" />
{// 加载头部公共文件 }
<include file="../Public/header" />
<SCRIPT LANGUAGE="JavaScript">
<!--
function getLabel(data){
	$('execSql').value = data;
}
function addLabel(){
	ThinkAjax.send('__URL__/getLabel','ajax=1&id='+$F('labelSql'),getLabel);
}
function delLabel(){
	if ($F('labelSql') != '')
	{
		ThinkAjax.send('__URL__/delLabel','ajax=1&id='+$F('labelSql'));
	}else {
		alert('选择标签');
	}
}
function buildTable(tableId,data) { 
for (i=0;i<data.length;i++){ 
  var row =$(tableId).insertRow(-1);
  if (i==0)
  {row.className = 'over';
  }
  for (j=0;j<data[i].length;j++) { 
	var cell = document.createElement("td");
	cell.innerHTML = data[i][j];
	row.appendChild(cell); 
    //var cell=row.insertCell(-1);
    //cell.innerText=data[i][j];
   }
 }
 }
function deleteTable(tableId){
	var Table	=	$(tableId);
		while (Table.rows.length > 0) {
			Table.deleteRow(0);
		}
}

function handleSql(data){
	deleteTable('table1');
	if(data.length<=1) {
		$('result').innerHTML	=	'无查询结果！';
		$('resultNum').innerHTML	=	'[ 返回0条查询记录 ] ';
	}else {
		$('resultNum').innerHTML	=	'[ 返回'+(data.length-1)+'条查询记录 ] ';
		buildTable('table1',data);
	}

}
function runSql(){
	ThinkAjax.send('__URL__/execute','ajax=1&sql='+$F('sql')+'&label='+$F('label'),handleSql);
}
	function labelSearch(){
		var obj	=	$('labelSql');
		var length = obj.options.length;
		for (i =0 ;i<length; i++){
			if (obj.options[i].text.indexOf($('searchLabel').value)!=-1)
			{
				obj.item(i).selected = true;
				break;
			}
		}
	}

	function checkTable(){
		var tableName	=	$F('tableName');
		var sql	=	'CHECK TABLE '+tableName+'';
		$('execSql').value	=	sql;
		ThinkAjax.send('__URL__/execute','ajax=1&sql='+sql,handleSql);
	}
	function searchTable(){
		var tableName	=	$F('tableName');	
		if (-1 != tableName.indexOf(','))
		{
			alert('只能选择单个数据表查询');return ;
		}
		var sql	=	'SELECT * FROM  '+tableName+' LIMIT 0,30';
		$('execSql').value	=	sql;
		ThinkAjax.send('__URL__/execute','ajax=1&sql='+sql,handleSql);
	}
	function optimizeTable(){
		var tableName	=	$F('tableName');
		var sql	=	'OPTIMIZE TABLE  '+tableName+'';
		$('execSql').value	=	sql;
		ThinkAjax.send('__URL__/execute','ajax=1&sql='+sql,handleSql);
	}
	function analyzeTable(){
		var tableName	=	$F('tableName');
		var sql	=	'ANALYZE TABLE '+tableName+'';
		$('execSql').value	=	sql;
		ThinkAjax.send('__URL__/execute','ajax=1&sql='+sql,handleSql);
	}
	function repairTable(){
		var tableName	=	$F('tableName');
		var sql	=	'REPAIR TABLE '+tableName+'';
		$('execSql').value	=	sql;
		ThinkAjax.send('__URL__/execute','ajax=1&sql='+sql,handleSql);
	}
	function outputTable(){
		var tableName	=	$F('tableName');
		window.location = "__URL__/output/table/"+tableName;
	}
//-->
</SCRIPT>
<!-- 菜单区域  -->
<div id="menu" class="menu"><include file="../Public/menu" /></div>
<!-- 主页面开始 -->
<div id="main" class="main" >
<!-- 主体内容  -->
<div class="content" >
<div class="title">数据库管理</div>
<!--  功能操作区域  -->
<div class="cBoth">
<div id="result" class="effect"></div>
<!-- SQL执行器 -->
<fieldset id="querybox" >
<legend style="color:gray">在数据库<span style="color:blue">{$FCS.DB_NAME}</span>中执行SQL语句（<span style="color:orange">请慎用</span>）</legend>
<div id="dbSql" class="vMargin">
<div class="fLeft"><TEXTAREA id="execSql" NAME="sql" check="Require" warning="输入要执行的SQL语句！" style="width:480px;height:190px;overflow:auto" ></TEXTAREA></div>
<div class="fLeft">
<SELECT id="labelSql" class="hMargin medium" NAME="labelName" size="12" ondblclick="addLabel()">
<volist name="labels" id="label" >
<option value="{$label.id}">{$label.label}</option>
</volist>
</SELECT></div>
<div id="dbSql" >
<div class="fLeft hMargin">
<SELECT NAME="tableName" id="tableName" class="medium" size="12" multiple >
<iterate name="tables" id="table" >
<option value="<write name="table" />"><write name="table" /></option>
</iterate>
</SELECT></div>
<div class="fLeft" style="width:65px">
<html:imageBtn value="查询" click="searchTable()" style="impBtn fLeft shadow" />
<html:imageBtn value="优化" click="optimzeTable()" style="impBtn vMargin fLeft shadow" />
<html:imageBtn value="检查" click="checkTable()" style="impBtn vMargin fLeft shadow" />
<html:imageBtn value="分析" click="analyzeTable()" style="impBtn vMargin fLeft shadow" />
<html:imageBtn value="修复" click="repairTable()" style="impBtn vMargin fLeft shadow" />
<html:imageBtn value="导出" click="outputTable()" style="impBtn vMargin fLeft shadow" />
</div>
</div>
</div>
<BR class="cBoth">
<div class="cBoth vMargin" >
<html:imageBtn value="执行" click="runSql()" style="impBtn hMargin fLeft shadow" />
<html:imageBtn type="reset" value="重置" style="impBtn hMargin fLeft shadow" />
<div class="fLeft">保存为标签：<INPUT TYPE="text" style="width:175px" NAME="label"></div>
<html:imageBtn value="删除" click="deLabel()" style="impBtn hMargin fLeft shadow" />
<div class="fLeft"><INPUT TYPE="text" id="searchLabel" style="width:100px" NAME="label"></div>
<html:imgLink name="search" alt="搜索"  click="labelSearch()" style=" hMargin fLeft shadow" />
</div>
</fieldset>

<!-- 表操作器 -->
<fieldset id="querybox" >
<legend style="color:gray">数据库查询结果 <span class="blue" id="resultNum"></span> </legend>
<div id="SqlResult" >
<table id='table1' class="list"></table>
</div>
</fieldset>
</div>
<!-- 列表显示区域结束 -->
</div>
<!-- 主体内容结束 -->
</div>
<!-- 主页面结束 -->
{// 加载尾部公共文件 }
<include file="../Public/footer" />